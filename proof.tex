\section{Correctness}


\begin{theorem}[Soundness]
\[
S \equiv T
\quad
\Rightarrow
\quad
\interp{S} \equiv \interp{T}
\]
\end{theorem}

\begin{proof}
We will prove different cases given in Figure~\ref{fig:equations} with respect
to the model given in Section~\ref{sec:semantics}.

\begin{description}
  \item[\textsc{Case F \texttt{+} F}:]
    \begin{align*}
      & \; \interp{\stenFwdS{a}{d} \; \texttt{+} \; \stenFwdS{b}{d}}_{n} \\
      \equiv & \; \interp{\stenFwdS{a}{d}}_{n} \; \cup \; \interp{\stenFwdS{b}{d}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{0, \ldots, a\} \} \; \cup \;
                  \{i\singleEntry{d}{n} \mid i \in \{0, \ldots, b\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{0, \ldots, a\}
                    \vee i \in \{0, \ldots, b\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{0, \ldots, a \max b\} \} \\
      \equiv & \; \interp{\stenFwdS{a \, \max \, b}{d}}_n \\
    \end{align*}
  \item[\textsc{Case C \texttt{+} C}:]
    \begin{align*}
      & \; \interp{\stenCenS{a}{d} \; \texttt{+} \; \stenCenS{b}{d}}_{n} \\
      \equiv & \; \interp{\stenCenS{a}{d}}_{n} \; \cup \; \interp{\stenCenS{b}{d}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \} \; \cup \;
                  \{i\singleEntry{d}{n} \mid i \in \{-b, \ldots, b\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\}
                    \vee i \in \{-b, \ldots, b\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{- (a \max b), \ldots, a \max b\} \} \\
      \equiv & \; \interp{\stenCenS{a \, \max \, b}{d}}_n \\
    \end{align*}
  \item[\textsc{Case B \texttt{+} B}:]
    \begin{align*}
      & \; \interp{\stenBwdS{a}{d} \; \texttt{+} \; \stenBwdS{b}{d}}_{n} \\
      \equiv & \; \interp{\stenBwdS{a}{d}}_{n} \; \cup \; \interp{\stenBwdS{b}{d}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, 0\} \} \; \cup \;
                  \{i\singleEntry{d}{n} \mid i \in \{-b, \ldots, 0\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, 0\}
                    \vee i \in \{-b, \ldots, 0\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{- (a \max b), \ldots, 0\} \} \\
      \equiv & \; \interp{\stenBwdS{a \, \max \, b}{d}}_n \\
    \end{align*}
  \item[\textsc{Case C \texttt{+} F}:]
    \begin{align*}
      & \; \interp{\stenCenS{a}{d} \; \texttt{+} \; \stenFwdS{b}{d}}_{n} \\
      \equiv & \; \interp{\stenCenS{a}{d}}_{n} \; \cup \; \interp{\stenFwdS{b}{d}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \} \; \cup \;
                  \{i\singleEntry{d}{n} \mid i \in \{0, \ldots, b\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\}
                    \vee i \in \{0, \ldots, b\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \} \quad \text{, using }a \geq b \\
      \equiv & \; \interp{\stenCenS{a}{d}}_n \\
    \end{align*}
  \item[\textsc{Case C \texttt{+} B}:]
    \begin{align*}
      & \; \interp{\stenCenS{a}{d} \; \texttt{+} \; \stenBwdS{b}{d}}_{n} \\
      \equiv & \; \interp{\stenCenS{a}{d}}_{n} \; \cup \; \interp{\stenBwdS{b}{d}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \} \; \cup \;
                  \{i\singleEntry{d}{n} \mid i \in \{-b, \ldots, 0\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\}
                    \vee i \in \{-b, \ldots, 0\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \} \quad \text{, using }a \geq b \\
      \equiv & \; \interp{\stenCenS{a}{d}}_n \\
    \end{align*}
  \item[\textsc{Case B \texttt{+} F}:]
    \begin{align*}
      & \; \interp{\stenBwdS{a}{d} \; \texttt{+} \; \stenFwdS{a}{d}}_{n} \\
      \equiv & \; \interp{\stenBwdS{a}{d}}_{n} \; \cup \; \interp{\stenFwdS{a}{d}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, 0\} \} \; \cup \;
                  \{i\singleEntry{d}{n} \mid i \in \{0, \ldots, a\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, 0\}
                    \vee i \in \{0, \ldots, a\} \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \} \\
      \equiv & \; \interp{\stenCenS{a}{d}}_n \\
    \end{align*}
  \item[\textsc{Case +COMM}:] Follows from commutativity of union of sets.
  \item[\textsc{Case +ASSOC}:] Follows from associativity of union of sets.
  \item[\textsc{Case *COMM}:] $\interp{r_1 \; \texttt{$\ast$} \; r_2}_n =
    \interp{r_1}_n \otimes \interp{r_2}_n$. Hence, $\texttt{$\ast$}$ is
    commutative iff $\otimes$ is commutative. Now let $\interp{r_1}_n$ and
    $\interp{r_2}_n$ be $S$ and $T$ respectively. Then from the definition of
    $\otimes$, we have $S \otimes T = \{ (s \bowtie t)_i \mid i \in
    \{ 1, \ldots, 2^n \}, (s,t) \in S \times T \}$. Then to show
    commutativity of $\otimes$, it is enough to show any row vector of $s
    \bowtie t$ is also a row vector in the matrix $t \bowtie s$ possibly with a
    different row index.

    Now let $\neg$ be a unary operator over logical matricies that revert $1$s
    to $0$s and vice versa. Then we can define pairwise permutation as
    $(s \bowtie t)_i = s \odot b_i + t \odot \neg b_i$. Now since $i$ ranges
    over all bit strings of length $n$, for all $i$ there is a $j$ such that
    $b_j = \neg b_i$. Hence for all $i$,

    \begin{align*}
      (s \bowtie t)_i &= s \odot b_i + t \odot \neg b_i \\
                      &= s \odot \neg b_j + t \odot \neg (\neg b_j) \\
                      &= t \odot \neg b_j + s \odot b_j \\
                      &= (t \bowtie s)_j
    \end{align*}

  \item[\textsc{Case *ASSOC}:] We have $\interp{r_1 \; \texttt{$\ast$} \;
    (r_2 \; \texttt{$\ast$} \; r_3)}_n = \interp{r_1}_n \otimes (\interp{r_2}_n
    \otimes \interp{r_3}_n)$ by definition. So we need to show $\otimes$ is
    associative. Now let $\interp{r_1}_n$, $\interp{r_2}_n$, and
    $\interp{r_2}_n$ be $R$, $S$, and $T$ respectively. From the definition of
    $\otimes$ we have, $\{ (r \bowtie st)_j \mid j \in \{ 1, \ldots, 2^n\},
    (r, st) \in R \times (S \otimes T) \}$ and that is the same as
    $\{ (r \bowtie (s \bowtie t)_i)_j \mid i,j \in \{ 1, \ldots, 2^n \}, (r,s,t)
    \in R \times S \times T \}$. If $\ast$ is associative, then an equivalent
    definition is $\{ ((r \bowtie s)_k \bowtie t)_l \mid k,l \in \{ 1, \ldots,
    2^n \}, (r,s,t) \in R \times S \times T \}$. Now since $b$ contains all
    bit strings of length $n$, for these two sets to be equivalent, it is
    enough to show that for any $r$, $s$, and $t$, for all $(i,j)$ pair there is
    a $(k,l)$ pair. When definition of $\bowtie$ is expanded, we then get the
    following equality:

    $$r \odot b_j + s \odot b_i \odot \neg b_j + t \odot \neg b_i \odot \neg b_j
    = r \odot b_k \odot b_l + s \odot \neg b_k \odot b_l + t \odot \neg b_l$$

    Hence, we get the following equations for logical row vectors:

    \begin{align}
      b_j & = b_k \odot b_l \\
      b_i \odot \neg b_j & = \neg b_k \odot b_l \\
      \neg b_i \odot \neg b_j & = \neg b_l
    \end{align}

    Observe that pairwise product on logical vectors corresponds to logical
    conjunction operation. In the following derivation $\wedge$ is used in place
    of $\odot$ for consistency. $\neg$ denotes logical negation of each element
    of the vector. Vector disjunction can be defined as $a \vee b = a + b - a
    \odot b$. Standard boolean algebra generalises over vectors.

    To see there is always a solution it is sufficient to show that the system
    of equations is consistent.

    \begin{align}
      b_j &= b_k \wedge (b_i \vee b_j) & \mbox{, by combining $(1)$ and $(3)$} \\
      b_i \wedge \neg b_j &= \neg b_k \wedge (b_i \vee b_j) & \mbox{, by combining $(2)$
        and $(3)$} \\
        b_i \vee b_j &= b_i \vee b_j & \mbox{, by combining $(4)$ and $(5)$}
    \end{align}

  \item[\textsc{Case DIST}:]
\end{description}
\end{proof}
