\documentclass[10pt]{sigplanconf}

\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage{color}
\usepackage{graphics}
\usepackage{fancyvrb}
\usepackage{subfigure}
\usepackage{amsthm}
\usepackage{tikz}
\usepackage{multirow}

\definecolor{darkblue}{rgb}{0.0,0.0,0.5}
\definecolor{darkgreen}{rgb}{0.0,0.4,0.0}
\definecolor{darkdarkgreen}{rgb}{0.0,0.35,0.0}

\usepackage[]{hyperref}
\hypersetup{
    unicode=false,          % non-Latin characters in Acrobat's bookmarks
    pdftoolbar=true,        % show Acrobat toolbar?
    pdfmenubar=true,        % show Acrobat menu?
    pdffitwindow=false,      % page fit to window when opened
    pdftitle={},    % title
    pdfauthor={}
    pdfsubject={},   % subject of the document
    pdfnewwindow=true,      % links in new window
    pdfkeywords={keywords}, % list of keywords
    colorlinks=true,       % false: boxed links; true: colored links
    linkcolor=darkblue,          % color of internal links
    citecolor=darkblue,        % color of links to bibliography
    filecolor=green,      % color of file links
    urlcolor=blue,          % color of external links
}


\CustomVerbatimEnvironment{SpecVerbatim}{Verbatim}{fontsize=\footnotesize,xleftmargin=0.5cm,
xrightmargin=0.2cm,commandchars=\\\{\},baselinestretch=0.98,numbersep=0.9em}
\CustomVerbatimEnvironment{ExmVerbatim}{Verbatim}{fontsize=\footnotesize,xleftmargin=0.5cm,
xrightmargin=0.2cm,baselinestretch=0.98,numbers=left,numbersep=0.9em,commandchars=\\\{\}}
\CustomVerbatimEnvironment{IVerbatim}{Verbatim}{fontsize=\relsize{-1},xleftmargin=0.5cm,
xrightmargin=0.2cm,commandchars=\\\{\},baselinestretch=0.98,numbersep=0.9em}


\definecolor{darkgreen}{rgb}{0.0,0.5,0.0}
\definecolor{darkpurple}{rgb}{0.6,0.0,0.6}
\definecolor{orange}{rgb}{0.8,0.4,0.0}
\definecolor{darkorange}{rgb}{0.5,0.2,0.0}
\definecolor{marco}{rgb}{0.0,0.3,0.5}
\definecolor{gray}{rgb}{0.2,0.2,0.2}

\newcommand{\bn}{\mathbb{N}}

\newcommand{\dnote}[1]{\textcolor{darkpurple}{Dom: #1}}
\newcommand{\mnote}[1]{\textcolor{darkgreen}{Mistral: #1}}
\newcommand{\anote}[1]{\textcolor{red}{Andy: #1}}

\newcounter{block}

\newtheorem{lemma}[block]{Lemma}
\newtheorem{proposition}[block]{Proposition}
%\newtheorem{definition}[block]{Definisssstion}

\theoremstyle{definition}

\newtheorem{theorem}[block]{Theorem}
\newtheorem{remark}[block]{Remark}
\newtheorem{example}[block]{Example}
\newtheorem{definition}[block]{Definition}

% Writing macros
\newcommand{\ie}{\emph{i.e.}}
\newcommand{\eg}{\emph{e.g.}}

\newcommand{\dimId}{\texttt{dim}}

% Semantics related
\newcommand{\interp}[1]{\llbracket{#1}\rrbracket}

% Syntax macros
\newcommand{\nonterm}[1]{\textit{#1}}
\newcommand{\term}[1]{\texttt{#1}}

\newcommand{\stenRefl}[1]{\term{reflexive} \, (\term{dim=}#1)}
\newcommand{\stenFwd}[3]{\term{forward} \, (\term{depth=}#1,
  \term{dim=}#2{#3})}
\newcommand{\stenBwd}[3]{\term{backward} \, (\term{depth=}#1,
  \term{dim=}#2{#3})}
\newcommand{\stenCen}[3]{\term{centered} \, (\term{depth=}#1,
  \term{dim=}#2{#3})}
\newcommand{\irrefl}{\texttt{irreflexive}}

\newcommand{\stenReflS}[1]{\term{refl} \, (\term{dim=}#1)}
\newcommand{\stenFwdS}[2]{\term{fwd} \, (\term{depth=}#1,
  \term{dim=}#2)}
\newcommand{\stenBwdS}[2]{\term{bwd} \, (\term{depth=}#1,
  \term{dim=}#2)}
\newcommand{\stenCenS}[2]{\term{cen} \, (\term{depth=}#1,
  \term{dim=}#2)}
\newcommand{\irreflS}{\texttt{irrefl}}

\newcommand{\stenFwdSR}[3]{\term{fwd} (\term{depth=}#1,
  \term{dim=}#2, #3)}
\newcommand{\stenBwdSR}[3]{\term{bwd} (\term{depth=}#1,
  \term{dim=}#2, #3)}
\newcommand{\stenCenSR}[3]{\term{cen} (\term{depth=}#1,
  \term{dim=}#2, #3)}
\newcommand{\stenReflSR}[1]{\term{refl} (\term{dim=}#1)}

% SYNTAX OPERATIONS AND PREDICATES
\newcommand{\neigh}{\textsf{neigh}}
\newcommand{\arrayTy}{\textsf{array}}
\newcommand{\rhsExp}{\textsf{rhsExp}}
\newcommand{\var}{\textsf{var}}

%% VECTOR NOTATIONS
\newcommand{\vect}[1]{\textbf{#1}}
\newcommand{\vtwoh}[2]{\setlength{\arraycolsep}{0em}
\left[\begin{array}{cc}#1 \; & \; #2\end{array}\right]}
\newcommand{\vthreeh}[3]{\setlength{\arraycolsep}{0em}
\left[\begin{array}{ccc}#1 \; & \; #2 \; & \; #3\end{array}\right]}
\newcommand{\vtwo}[2]{\setlength{\arraycolsep}{0em}
\left[\begin{array}{l}$#1$\\$#2$\end{array}\right]}
\newcommand{\vthree}[3]{\setlength{\arraycolsep}{0em}
\left[\begin{array}{l}$#1$\\$#2$\\$#3$\end{array}\right]}
\newcommand{\stwo}[4]
%{\vtwo{#1}{#2}\!\vtwo{#3}{#4}}
{\setlength{\arraycolsep}{0.1em}
\left[\begin{array}{rr}$#1$ & $#3$\\$#2$ & $#4$\end{array}\right]}

\newcommand{\singleEntry}[2]{\textbf{J}_{#2}^{#1}}
\newcommand{\zeroEntry}[2]{\textbf{K}_{#2}^{#1}}

%% OPERATIONS ON SPANS and VECTORS
\newcommand{\containedin}{\sqsubseteq}

%% MODEL
\newcommand{\effdims}[2]{\mathit{constr}(#1)_{#2}}

\newcommand{\consName}{\textbf{agree'}}
\newcommand{\cons}[2]{#1 \,\, \consName{} \,\, #2}
\newcommand{\consAName}{\textbf{agree}}
\newcommand{\consA}[2]{#1 \,\, \consAName{} \,\, #2}
\newcommand{\consSub}[3]{#2 \,\, \consAName{}_{#1} \,\,#3}

\newcommand{\trule}[1]{{\footnotesize{(\text{#1})}}}


\usepackage{xypic}

\title{Supplementary material}
\authorinfo{}{}{}

\begin{document}
\onecolumn

\begin{center}
{\LARGE{{Supplementary material for 
\textbf{Verifying Spatial Properties of Stencil Computations}}}}
\end{center}

\appendix

\input{proof.tex}

\begin{theorem}[Soundness of approximation]
\begin{align*}
\forall S, T, M . \quad S <: T \; \wedge \; \consA{M}{\interp{S}_n}  \;
\Rightarrow \consA{M}{\interp{T}_n}
\end{align*}
\end{theorem}

\begin{proof}
By induction on the definition of $<:$.

Some intermediate results on approximation of regions are useful:

\begin{lemma}
For all regions $R, S$ then $R <: S \Rightarrow \textit{constr}(\interp{R})
= \textit{constr}(\interp{S})$
\end{lemma}

\begin{lemma}[Subregions imply submodels]
For all regions $R, S$ then  $R <:^r S \; \Rightarrow \interp{R}_n
\subseteq \interp{S}_n$.
\label{lem:subr-to-subm}
\end{lemma}
\begin{proof}
\begin{itemize}
\item \trule{\textsc{over}}  
 \begin{itemize}
   \item $\term{fwd} <: \term{fwd}$, $r \Rightarrow s$ and $m \leq n$,
     then $\{\zeroEntry{d}{n} \mid r \} \cup
 \{i\singleEntry{d}{n} \,|\, i \in \{1, ..., m\} \} \subseteq 
\{\zeroEntry{d}{n} \mid s \} \cup
 \{i\singleEntry{d}{n} \,|\, i \in \{1, ..., n\} \}$
   \item The rest of the cases for OVER similarly follow the shape of
     the model straightforwardly.
 \end{itemize}
\item \trule{\textsc{cong$\term{+}$}} Straightforward by monontonicity
  of $\cup$ and the model of $\interp{R_1 + R_2} = \interp{R_1} \cup
  \interp{R_2}$.
\item \trule{\textsc{cong$\term{*}$}} By the inductive hypothesis
$R_1 <: S_1$ and $\interp{R_1} \subseteq \interp{S_1}$ and
$R_2 <: S_2$ and $\interp{R_2} \subseteq \interp{S_2}$. 

Therefore, by the subset property in the inductive hypotheses then
 $(u \bowtie v)_i \in \interp{R_1} \bowtie \interp{S_1} 
\Rightarrow \interp{R_2} \bowtie \interp{S_2}$ by the properties of
$\bowtie$ an the above lemma that $R <: S \Rightarrow \textit{constr}(\interp{R})
= \textit{constr}(\interp{S})$. Therefore
$\interp{R_1 \ast S_1} \subseteq \interp{R_2 \ast S_2}$.
\end{itemize}
\end{proof}

\begin{itemize}
\item \trule{\textsc{grow}} $R <:^r S \; \Rightarrow \; R <: \term{atMost} \,
  S$
By the above Lemma~\ref{lem:subr-to-subm} then $\interp{R} \subseteq
\interp{S}$. Given $\consA{M}{\interp{R}}$ then it follows
that $\forall u \in M, \exists v \in \interp{R} . u \preceq v$ and
thus $\forall u \in M, \exists v \in \interp{S} . u \preceq v$ which
is equivalent to the consitency
$\consA{M}{\interp{\term{atMost}{S}}}$ $\qed$.

\item \trule{\textsc{shrink}} The dual of the above proof.

\item \trule{\textsc{Gen$\ast$}} $\mathsf{dims}(R) \cap \mathsf{dims}(S) =
  \emptyset \Rightarrow (R \ast S) <: R$  and (*) $\consA{M}{\interp{R\ast S}_n}$

\begin{align*}
N = &   \Bigg\{x \; \Bigg| \;
    \parbox{5.9cm}{$(u, v) \in \interp{R}_n \times \interp{S}_n $ \\[0.1em]
                 $\;\; \wedge \;\, j \in (\effdims{\interp{R}}{n} \cup
                   \effdims{\interp{S}}{n})$\\[0.1em]
                  $\;\; \wedge \;\, i \in \{1, \ldots, 2^n\} \, \wedge
                  \, x = (u \bowtie v)_i$ \\[0.1em]
                   $\;\; \wedge \;\, x_j \neq \infty$
                  } \Bigg\} \\
\consA{M}{\interp{R\ast S}_n} & = (\forall ua \in M, \exists va \in N . ua
  \preceq va) \; \wedge \; (\forall va' \in N, \exists ua' \in M . ua' \preceq
    va')
\end{align*}
%
[Goal $\consA{M}{\interp{R}_n} = (\forall u \in M, \exists v \in \interp{R}_n . u
  \preceq v) \; \wedge \; (\forall v' \in \interp{R}_n, \exists u' \in M . u' \preceq
    v')$]

The defined dimensions of $R$ and $S$ are disjoint
($\mathsf{dims}(R) \cap \mathsf{dims}(S) =
  \emptyset$) that implies that:
%
\begin{align}
& \forall d \in \mathsf{dims}(R) . \, \forall v \in \interp{S}_n . \,
  vs_d = \infty \\
& \forall d \in \mathsf{dims}(S) . \, \forall v \in \interp{R}_n . \, 
  vr_d = \infty
\label{eq:sepa}
\end{align}

\begin{itemize}
\item \textbf{Left of conjunct}

Assume $u \in M$ and instantiate the universal of the assumptions such
that $ua = u$ and let $va \in N$ by existential elimination.

By the definition of $N$ and the
above property~\eqref{eq:sepa}, we know that for all $d \in \mathsf{dims}(R)$
and $e \in \mathsf{dims}(S)$ that $va_d$ matches some $vr_d$
and $va_e$ matches some $vs_e$. Therefore, there is an scheme
$v' \in \interp{R}_n$ where all $v'_e = \infty$ and therefore
$ua \preceq v'$. By existential introduction on $v'$ then we have
the left conjunt of the goal. $\qed$

\item \textbf{Right of conjunct}
Assume $v' \in \interp{R}_n$. 

Pick an arbitrary $vs \in \interp{S}_n$. 
For all $d \in \mathsf{dims}(R)$
and $e \in \mathsf{dims}(S)$
let $va'_d = v'_d$ and let $va'_e = vs_e$.

Instantiate the assumption then such that $\exists ua' \in M$
where $ua' \preceq va'$.  Since $v'$ is more general than $va'$
it also holds that $ua' \preceq v'$. By existential introduction,
let $u' = ua'$ providing the right conjunct of the goal $\qed$.
\end{itemize}

\item \trule{\textsc{Eq}} trivial by soundness of $\equiv$.
\item \trule{\textsc{Cong\texttt{R}}} follows straightforwardly by the $(1 \leq *)$ 
cause for consistency
\item \trule{\textsc{rep}} follows by $(*)$.

\end{itemize}
\end{proof}

\end{document}

