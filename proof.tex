\section{Correctness}


\begin{theorem}[Soundness]
\[
S \equiv T
\quad
\Rightarrow
\quad
\interp{S} \equiv \interp{T}
\]
\end{theorem}

\begin{proof}
By induction on the equations given in Figure~\ref{fig:equations}, with respect
to the model given in Section~\ref{sec:semantics}.

\begin{description}
  \item[\textsc{Case F \texttt{+} F}:]
    \begin{align*}
      & \; \interp{\stenFwdSR{a}{d}{r} \; \texttt{+} \; \stenFwdSR{b}{d}{s}}_{n} \\
      \equiv & \; \interp{\stenFwdSR{a}{d}{r}}_{n} \cup \interp{\stenFwdSR{b}{d}{s}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{1, \ldots, a\} \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{1, \ldots, b\} \} \cup
                  \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{1, \ldots, a\} \vee
                                             i \in \{1, \ldots, b\} \} \cup
                 \{\zeroEntry{d}{n} \mid r \} \cup \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{1, \ldots, a \max b\} \} \cup 
                  \{\zeroEntry{d}{n} \mid r \vee s \}\\
      \equiv & \; \interp{\stenFwdSR{a \, \max \, b}{d}{r \vee s}}_n \\
    \end{align*}
  \item[\textsc{Case C \texttt{+} C}:]
    \begin{align*}
      & \; \interp{\stenCenSR{a}{d}{r} \; \texttt{+} \; \stenCenSR{b}{d}{s}}_{n} \\
      \equiv & \; \interp{\stenCenSR{a}{d}{r}}_{n} \cup \interp{\stenCenSR{b}{d}{s}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \setminus 0 \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{-b, \ldots, b\} \setminus 0 \} \cup
                 \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \setminus 0 \vee
                                             i \in \{-b, \ldots, b\} \setminus 0 \} \cup
                 \{\zeroEntry{d}{n} \mid r \} \cup \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-(a \max b), \ldots, a \max b\} \setminus 0 \} \cup 
                  \{\zeroEntry{d}{n} \mid r \vee s \}\\
      \equiv & \; \interp{\stenCenSR{a \, \max \, b}{d}{r \vee s}}_n \\
    \end{align*}
  \item[\textsc{Case B \texttt{+} B}:]
    \begin{align*}
      & \; \interp{\stenBwdSR{a}{d}{r} \; \texttt{+} \; \stenBwdSR{b}{d}{s}}_{n} \\
      \equiv & \; \interp{\stenBwdSR{a}{d}{r}}_{n} \cup \interp{\stenBwdSR{b}{d}{s}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, -1\} \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{-b, \ldots, -1\} \} \cup
                  \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, -1\} \vee
                                             i \in \{-b, \ldots, -1\} \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \cup \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-(a \max b), \ldots, -1 \} \} \cup 
                  \{\zeroEntry{d}{n} \mid r \vee s \}\\
      \equiv & \; \interp{\stenBwdSR{a \, \max \, b}{d}{r \vee s}}_n \\
    \end{align*}
  \item[\textsc{Case C \texttt{+} F}: with side condition  $\;\;(a \geq b)$]
    \begin{align*}
      & \; \interp{\stenCenSR{a}{d}{r} \; \texttt{+} \; \stenFwdSR{b}{d}{s}}_{n} \\
      \equiv & \; \interp{\stenCenSR{a}{d}{r}}_{n} \cup \interp{\stenFwdSR{b}{d}{s}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \setminus 0 \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{1, \ldots, b\} \} \cup
                  \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \setminus 0
                    \vee i \in \{1, \ldots, b\} \} \cup
                 \{\zeroEntry{d}{n} \mid r \} \cup \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\}
               \setminus 0 \} \cup \{\zeroEntry{d}{n} \mid r \vee s \} \quad \text{, using }a \geq b \\
      \equiv & \; \interp{\stenCenSR{a}{d}{r \vee s}}_n \\
    \end{align*}
  \item[\textsc{Case C \texttt{+} B}: with side condition  $\;\;(a \geq b)$]
    \begin{align*}
      & \; \interp{\stenCenSR{a}{d}{r} \; \texttt{+} \; \stenBwdSR{b}{d}{s}}_{n} \\
      \equiv & \; \interp{\stenCenSR{a}{d}{r}}_{n} \cup \interp{\stenBwdSR{b}{d}{s}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \setminus 0 \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{-b, \ldots, -1\} \} \cup
                  \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \setminus 0
                    \vee i \in \{-b, \ldots, -1\} \} \cup
                 \{\zeroEntry{d}{n} \mid r \} \cup \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\}
               \setminus 0 \} \cup \{ \zeroEntry{d}{n} \mid r \vee s \} \quad \text{, using }a \geq b \\
      \equiv & \; \interp{\stenCenSR{a}{d}{r \vee s}}_n \\
    \end{align*}
  \item[\textsc{Case B \texttt{+} F}:]
    \begin{align*}
      & \; \interp{\stenBwdSR{a}{d}{r} \; \texttt{+} \; \stenFwdSR{a}{d}{r}}_{n} \\
      \equiv & \; \interp{\stenBwdSR{a}{d}{r}}_{n} \cup \interp{\stenFwdSR{a}{d}{s}}_{n} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, -1\} \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{1, \ldots, a\} \} \cup
                  \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, -1\}
                    \vee i \in \{1, \ldots, a\} \} \cup
                 \{\zeroEntry{d}{n} \mid r \} \cup \{\zeroEntry{d}{n} \mid s \} \\
      \equiv & \; \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\} \setminus 0 \} \cup 
                              \{\zeroEntry{d}{n} \mid r \vee s \} \\
      \equiv & \; \interp{\stenCenSR{a}{d}{r \vee s}}_n \\
    \end{align*}
%
%
  \item[\textsc{Case R \texttt{+} F}:]
    \begin{align*}
      & \; \interp{\stenReflS{d} \; \texttt{+} \; \stenFwdSR{a}{d}{r}}_{n} \\
      \equiv & \; \interp{\stenReflS{d}}_{n} \cup \interp{\stenFwdSR{a}{d}{r}}_{n} \\
      \equiv & \; \{\zeroEntry{d}{n}\} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{1, \ldots, a\} \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \\
      \equiv & \; \{\zeroEntry{d}{n}\} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{1, \ldots, a\} \} \\
      \equiv & \; \interp{\stenFwdS{a}{d}}_n \\
    \end{align*}
%
%
  \item[\textsc{Case R \texttt{+} B}:]
    \begin{align*}
      & \; \interp{\stenReflS{d} \; \texttt{+} \; \stenBwdSR{a}{d}{r}}_{n} \\
      \equiv & \; \interp{\stenReflS{d}}_{n} \cup \interp{\stenBwdSR{a}{d}{r}}_{n} \\
      \equiv & \; \{\zeroEntry{d}{n}\} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, -1\} \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \\
      \equiv & \; \{\zeroEntry{d}{n}\} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, -1\} \} \\
      \equiv & \; \interp{\stenBwdS{a}{d}}_n \\
    \end{align*}

%
  \item[\textsc{Case R \texttt{+} C}:]
    \begin{align*}
      & \; \interp{\stenReflS{d} \; \texttt{+} \; \stenCenSR{a}{d}{r}}_{n} \\
      \equiv & \; \interp{\stenReflS{d}}_{n} \cup \interp{\stenCenSR{a}{d}{r}}_{n} \\
      \equiv & \; \{\zeroEntry{d}{n}\} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\}
               \setminus 0 \} \cup
                  \{\zeroEntry{d}{n} \mid r \} \\
      \equiv & \; \{\zeroEntry{d}{n}\} \cup
                  \{i\singleEntry{d}{n} \mid i \in \{-a, \ldots, a\}
               \setminus 0 \} \\
      \equiv & \; \interp{\stenCenS{a}{d}}_n \\
    \end{align*}
  \item[\textsc{Case +IDEM, +COMM, +ASSOC}:]
    Follows from respective properties of union of sets.
  \item[\textsc{Case *COMM}:] $\interp{r_1 \; \texttt{$\ast$} \; r_2}_n =
    \interp{r_1}_n \otimes \interp{r_2}_n$. Hence, $\texttt{$\ast$}$ is
    commutative iff $\otimes$ is commutative. Now let $\interp{r_1}_n$ and
    $\interp{r_2}_n$ be $S$ and $T$ respectively. Then from the definition of
    $\otimes$, we have $S \otimes T = \{ (s \bowtie t)_i \mid k \in
    \{ 1, \ldots, 2^n \}, (s,t) \in S \times T \}$. Then to show
    commutativity of $\otimes$, it is enough to show for any vectors $s$ and
    $t$, any row vector of $s \bowtie t$ is also a row vector in the matrix
    $t \bowtie s$ possibly with a different row index, since $\otimes$ collects
    row vectors of pairwise permutations. This in effect means $s \bowtie t$
    is a permutation of $t \bowtie s$'s rows.

    Now let $\neg$ be a unary operator over logical matricies that revert $1$s
    to $0$s and vice versa. Then we can define pairwise permutation as
    $(s \bowtie t)_k = s \odot b_k + t \odot \neg b_k$. Now since $k$ ranges
    over all bit strings of length $n$, for all $k$ there is a $l$ such that
    $b_l = \neg b_k$. Hence for all $k$,

    \begin{align*}
      (s \bowtie t)_k &= s \odot b_k + t \odot \neg b_k \\
                      &= s \odot \neg b_l + t \odot \neg (\neg b_l) \\
                      &= t \odot \neg b_l + s \odot b_l \\
                      &= (t \bowtie s)_l
    \end{align*}

  \item[\textsc{Case *ASSOC}:] We have $\interp{r_1 \; \texttt{$\ast$} \;
    (r_2 \; \texttt{$\ast$} \; r_3)}_n = \interp{r_1}_n \otimes (\interp{r_2}_n
    \otimes \interp{r_3}_n)$ by definition. So we need to show $\otimes$ is
    associative. Now let $\interp{r_1}_n$, $\interp{r_2}_n$, and
    $\interp{r_3}_n$ be $R$, $S$, and $T$ respectively. From the definition of
    $\otimes$ we have, $\{ (r \bowtie st)_j \mid j \in \{ 1, \ldots, 2^n\},
    (r, st) \in R \times (S \otimes T) \}$ and that is the same as
    $\{ (r \bowtie (s \bowtie t)_i)_j \mid i,j \in \{ 1, \ldots, 2^n \}, (r,s,t)
    \in R \times S \times T \}$. If $\ast$ is associative, then an equivalent
    definition is $\{ ((r \bowtie s)_k \bowtie t)_l \mid k,l \in \{ 1, \ldots,
    2^n \}, (r,s,t) \in R \times S \times T \}$. For these two sets to be
    equivalent, it is enough to show that for any $r$, $s$, and $t$, for each
    $(i,j)$ pair there is a $(k,l)$ pair. When definition of $\bowtie$ is
    expanded, we then get the following equality:

    $$r \odot b_j + s \odot b_i \odot \neg b_j + t \odot \neg b_i \odot \neg b_j
    = r \odot b_k \odot b_l + s \odot \neg b_k \odot b_l + t \odot \neg b_l$$

    Hence, we get the following equations for logical row vectors:

    \begin{align}
      b_j & = b_k \odot b_l \\
      b_i \odot \neg b_j & = \neg b_k \odot b_l \\
      \neg b_i \odot \neg b_j & = \neg b_l
    \end{align}

    Observe that pairwise product on logical vectors corresponds to logical
    conjunction operation. In the following derivation $\wedge$ is used in place
    of $\odot$ for consistency. $\neg$ denotes logical negation of each element
    of the vector. Vector disjunction can be defined as $a \vee b = a + b - a
    \odot b$. Standard boolean algebra generalises over vectors.

    To see there is always a solution it is sufficient to show that the system
    of equations is consistent.

    \begin{align}
      b_l &= b_i \vee b_j & \mbox{, negating $(3)$ and applying De Morgan's law} \\
      b_j &= b_k \wedge (b_i \vee b_j) & \mbox{, substituting $(4)$ into $(1)$} \\
      b_i \wedge \neg b_j &= \neg b_k \wedge (b_i \vee b_j) & \mbox{, substituting $(4)$
        into $(2)$} \\
      b_j \vee b_i \wedge \neg b_j &= b_k \wedge (b_i \vee b_j) \vee \neg b_k \wedge (b_i \vee b_j) & \mbox{, disjunction of $(5)$ and $(6)$} \\
      b_i \vee b_j &= b_i \vee b_j & \mbox{, algebraically simplifying (7)} \nonumber
    \end{align}

  \item[\textsc{Case DIST}:]
    \begin{align*}
             & \interp{r_1 \; \ast \; (r_2 \; \texttt{+} \; r_3)}_n \\
      \equiv & \interp{r_1}_n \otimes \interp{r_2 \; \texttt{+} \; r_3}_n \\
      \equiv & \interp{r_1}_n \otimes (\interp{r_2}_n \cup \interp{r_3}_n) \\
      \equiv & \{ (u \bowtie v)_i \mid i \in \{ 1, \ldots, 2^n \}, (u,v) \in
        \interp{r_1}_n \times (\interp{r_2}_n \cup \interp{r_3}_n) \} \\
      \equiv & \{ (u \bowtie v)_i \mid i \in \{ 1, \ldots, 2^n \}, (u,v) \in
        \interp{r_1}_n \times \interp{r_2}_n \vee (u,v) \in \interp{r_1}_n
        \times \interp{r_3}_n \} \\
      \equiv & \{ (u \bowtie v)_i \mid i \in \{ 1, \ldots, 2^n \}, (u,v) \in
        \interp{r_1}_n \times \interp{r_2}_n \}
        \cup \{ (u \bowtie v)_i \mid i \in \{ 1, \ldots, 2^n \}, (u,v) \in
        \interp{r_1}_n \times \interp{r_3}_n \} \\
      \equiv & (\interp{r_1}_n \otimes \interp{r_2}_n)
        \cup (\interp{r_1}_n \otimes \interp{r_3}_n) \\
      \equiv & (\interp{r_1 \ast r_2}_n) \cup (\interp{r_1 \ast r_3}_n) \\
      \equiv & \interp{r_1 \ast r_2 + r_1 \ast r_3}_n \\
    \end{align*}
\end{description}
\end{proof}
