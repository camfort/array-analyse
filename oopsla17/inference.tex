\documentclass[acmlarge,review]{acmart}

\usepackage{enumitem}
\usepackage{amsthm}

\usepackage{stencilmacros}

\newcommand{\vect}[1]{\textbf{#1}}
%\renewcommand\ttdefault{cmtt}

% Essential declarations
\theoremstyle{definition}
\newtheorem{defn}{Definition}

\theoremstyle{plain}
\newtheorem{thm}{Theorem}
\newtheorem{lem}{Lemma}
\newtheorem{prop}{Proposition}
\newtheorem{case}{Case}

\theoremstyle{remark}
\newtheorem{remark}{Remark}

\title{Stencil specification inference}

\begin{document}
\maketitle

\begin{defn}{Hyperrectangle and $n$-dimensional closed intervals}
A hyperrectangle is an $n$-dimensional rectangular polygon (also
called rectilinear polygon).
\end{defn}

\noindent
Recall the function $\textit{schematic}_I$ parameterised by
a set of induction variables $I$, which maps
from an array subscript into a $n$-dimensional (closed) interval:
%
\begin{align*}
\textit{schematic}_I(\bar{e}) & =
\prod_{i \in |\bar{e}|} \textit{interval}(e_i)
\qquad
\textit{interval}_I(e) = \begin{cases}
[c, c] & e = i \pm c \, \wedge \, i \in I \\
[-\infty, \infty] & FV(e) \cap I = \emptyset
\end{cases}
\end{align*}
Note that \textit{inveral} may be undefined (it is a partial function)
in which case \textit{schematic} is similarly undefined if any of its
components are undefined.

\noindent
Specification inference is demonstrated on the following five-point
stencil code:
%
\begin{center}
\begin{verbatim}
        b(i,j) = (a(i, j) + a(i-1, j) + a(i, j-1) + a(i, j+1) + a(i+1, j)) / 5.0
\end{verbatim}
\end{center}
%

\begin{enumerate}[leftmargin=1.5em]
\item \textbf{Analysis} A source code analysis converts array subscripts into
  $n$-dimensional via \textit{schematic}. Intervals are grouped as a
  finite map  by the array variable read from. For our example:
%
\begin{equation*}
\texttt{a} \mapsto \{[0,0]\times[0,0], \;\; [-1,0]\times[0,0], \;\;
[0,0]\times[-1,0], \;\; [0,0]\times[1,0], \;\; [0,1]\times[0,0]\}
\end{equation*}
%


\item \textbf{Coalesce intervals}
Intervals which are \emph{contiguous} in one dimension are then
repeatedly coalesced.

\begin{definition}[Contiguous intervals]
Two $n$-dimensional intervals $\vect{x}$ and $\vect{y}$ are
\emph{contiguous} if each component is equal:
%
\begin{equation*}
\exists j \in \{1, \ldots, n\} . \pi_j \vect{x} = [x_l, x_u] 
\wedge \pi_j \vect{y} = [y_l, y_u] 
\wedge x_u + 1 = y_l 
\wedge (\forall i \in \{1, \ldots, n\}, i \neq j . \; \pi_i \vect{x} =
\pi_i \vect{y})
\end{equation*}
%
\end{definition}

\end{enumerate}

\end{document}
