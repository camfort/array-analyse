\documentclass{article}

% Essential packages
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage{indentfirst}
\usepackage{cleveref}
\usepackage{xifthen}

% Non-essential
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}

% Essential declarations
\theoremstyle{definition}
\newtheorem{defn}{Definition}

\theoremstyle{plain}
\newtheorem{thm}{Theorem}
\newtheorem{lem}{Lemma}
\newtheorem{prop}{Proposition}
\newtheorem{case}{Case}

\theoremstyle{remark}
\newtheorem{remark}{Remark}

% Auxillary declaration
\newcommand{\eg}{\emph{e.g.}}

% Essential macros
\newcommand{\zinf}{\textnormal{$\mathbb{Z}_\infty$}}
\newcommand{\interp}[1]{\llbracket {#1} \rrbracket}
\newcommand{\interv}[3]{\textnormal{$\lbrack#1,#2\rbrack^{#3}$}}
\newcommand{\vecgen}[3]{\textnormal{$\textit{vec-gen}_{#1}(#2,#3)$}}
\newcommand{\textcap}[1]{\texttt{\textit{#1}}}

% Stencil macro
%
% Optional argument: s when we want the short form, empty otherwise.
%
% Mandatory arguments:
% 1st: c/b/f/p for centered, backward, forward, pointed
% 2st: dimension
% 3st: depth
% 4st: if pointed/nonpointed needs to be specified leave it blank if omitted.
%
% Example: \stencil[s]{f}{1}{2}{} = fwd(dim=1,depth=2)
% Example: \stencil{b}{1}{2}{pointed} = backward(dim=1,depth=2,pointed)
\newcommand{\stencil}[5][]{%
  \ifthenelse{\equal{#2}{f}}{%
    \ifthenelse{\equal{#1}{s}}{%
      \texttt{fwd}%
    }{\ifthenelse{\isempty{#1}}{%
        \texttt{forward}%
      }{INVALID OPTIONAL}%
    }%
  }{\ifthenelse{\equal{#2}{b}}{%
      \ifthenelse{\equal{#1}{s}}{%
          \texttt{bwd}%
      }{\ifthenelse{\isempty{#1}}{%
          \texttt{backward}%
        }{INVALID OPTIONAL}%
      }%
  }{\ifthenelse{\equal{#2}{c}}{%
      \ifthenelse{\equal{#1}{s}}{%
          \texttt{ctd}%
      }{\ifthenelse{\isempty{#1}}{%
          \texttt{centered}%
        }{INVALID OPTIONAL}%
      }%
  }{\ifthenelse{\equal{#2}{p}}{%
      \ifthenelse{\equal{#1}{s}}{%
          \texttt{ptd}%
      }{\ifthenelse{\isempty{#1}}{%
          \texttt{pointed}%
        }{INVALID OPTIONAL}%
      }%
  }{}}}}%
  \texttt{(dim=\textnormal{#3}%
    \ifthenelse{\isempty{#4}}{}{,depth=\textnormal{#4}}%
    \ifthenelse{\isempty{#5}}{}{,\textnormal{#5}}%
  )}%
}

% Non-essential macro
\definecolor{unused}{RGB}{211,167,192}
\newcommand{\unused}[1]{{\color{unused} #1}}

\begin{document}

\section{Giving specifications meaning}

We construct a lattice and use this lattice to give meanings to regions. We
then give full meaning to specifications by wrapping regions in variant types
for multiplicity and approximation. Model defined in this section will later be
used for two purposes. First, we show soundness of the equational theory of
specifications with respect to the model. Second, we define inference and
consistency checking procedures of specifications with respect to the
interpretations of the stencils in the code and the specifications.

\subsection{Constructing the lattice model of regions}

\begin{defn}{(\zinf)}
  We define the set \zinf{} as $\mathbb{Z}$ extended with $\infty$ and
  $-\infty$. For any $n$ in \zinf{}, we have $-\infty \leq n \leq \infty$. The
  resulting set is a total order with top and bottom elements.
\end{defn}

\begin{defn}{(\emph{Offset space})}
  \emph{Offset space} is a subset of \zinf{} members. It is used to capture
  offsets from induction variables.

%  $\mathcal{P}(\zinf{})$ couple with $\supseteq$ is the power set distributive
%  lattice.
\end{defn}

\begin{defn}{(\emph{\zinf{} interval})}
  A \emph{\zinf{} interval} is of the form \interv{a}{b}{c}, where $a$ and $b$
  are drawn from \zinf{} with $a \leq 0 \leq b$ and $c$ is a Boolean value. We
  define it as follows:
%
  \begin{equation*}
    \interv{a}{b}{c} \triangleq
      \{ n \;|\; a \leq n \leq b \wedge (\neg c \implies n \neq 0) \}
  \end{equation*}

  Set of all such intervals (sets) is $\textit{Interval}$.
\end{defn}

\begin{lem}{}\label{lem:zinf-identities}
  We have the following dual identities for \zinf{} intervals:
%
  \begin{align*}
    \interv{a}{b}{c} \cap \interv{d}{e}{f} & =
      \interv{\max \{a,d\}}{\min \{b,e\}}{c \wedge f} \\
    \interv{a}{b}{c} \cup \interv{d}{e}{f} & =
      \interv{\min \{a,d\}}{\max \{b,e\}}{c \vee f}
  \end{align*}
\end{lem}
%
\begin{proof}
  We give the proof of the first identity and the second one is similar.
  \begin{align*}
    \interv{a}{b}{c} \cap \interv{d}{e}{f} = &
      \; \{ n \;|\; a \leq n \leq b \wedge (\neg c \implies n \neq 0) \}
      \;\cap \\
      & \; \{ n \;|\; d \leq n \leq e \wedge (\neg f \implies n \neq 0) \}
      \\
    = & \; \{ n \;|\; \max \{a,d\} \leq n \leq \min \{b,e\} \wedge (\neg c
      \vee \neg f \implies n \neq 0) \} \\
    = & \; \interv{\max{\{a,d\}}}{\min{\{b,e\}}}{\neg c \vee \neg f}
  \end{align*}
\end{proof}

\begin{defn}{(\emph{Offsets vector})}
  An \emph{offsets vector} is a $N$ dimensional vector of offset spaces denoted
  by $(\textit{offs}_1, \dots, \textit{offs}_N)$ to mean $\textit{offs}_1 \times
  \dots \times \textit{offs}_N$.

  The set of $N$ dimensional offsets vectors is
  $\mathcal{P}{(\zinf{}^{\mkern-19mu{N}})}$ and they trivially form a
  distributive lattice under the superset relation.
\end{defn}

\unused{
\begin{lem}{}\label{lem:vector-intersect}
  Intersection distributes over offsets vectors.
%
  \begin{equation*}
    (\textit{vint}_1, \dots, \textit{vint}_N) \;\cap\;
      (\textit{vint'}_1, \dots, \textit{vint'}_N)
      =
    (\textit{vint}_1 \;\cap\; \textit{vint'}_1, \dots,
     \textit{vint}_N \;\cap\; \textit{vint'}_N)
  \end{equation*}
\end{lem}
%
\begin{proof}
  TODO. Trivial. Do if needed.
\end{proof}
}

\begin{lem}{}\label{lem:vector-union}
  Let $v$ and $v'$ be two $N$ dimensional offsets vectors such that $v_i$ is
  equal to $v'_i$ for all $1 \leq i \leq N$ except $k$, then we have the
  following:
%
  \begin{equation*}
    (v_1,\dotsc, v_k,\dotsc, v_N) \; \cup \; (v'_1,\dotsc, v'_k, \dotsc, v_N)
    =
    (v_1,\dotsc, v_k \cup v'_k,\dotsc, v_N)
  \end{equation*}
\end{lem}
%
\begin{proof}
  \begin{align*}
    v \; \cup \; v' &
    = \{(x_1,\dotsc,x_n) \mid
          \bigwedge_{1 \leq i \leq N } x_i \in v_i \}
      \;\cup\;
      \{(x_1,\dotsc,x_n) \mid
          \bigwedge_{1 \leq i \leq N } x_i \in v'_i \} \\
    & = \{(x_1,\dotsc,x_n) \mid
          \bigwedge_{\substack{1 \leq i \leq N \\ i \neq k}} x_i \in v_i
              \wedge x_k \in v_k \vee
          \bigwedge_{\substack{1 \leq i \leq N \\ i \neq k}} x_i \in v'_i
            \wedge x_k \in v'_k
        \} \\
    & = \{(x_1,\dotsc,x_n) \mid
          \bigwedge_{\substack{1 \leq i \leq N \\ i \neq k}} x_i \in v_i
          \wedge x_k \in v_k \cup v'_k
        \} \\
    & = (v_1,\dotsc, v_k \cup v'_k,\dotsc, v_N)
  \end{align*}
\end{proof}

\begin{defn}{(\emph{Vector interval})}
  A vector interval is an $N$ dimensional object which has \zinf{} intervals at
  each dimension. It is denoted with $(\textit{int}_1, \dots, \textit{int}_n)$,
  where $\textit{int}_i$ is a \zinf{} interval. If \textit{vint} is a vector
  interval, $\textit{vint}_i$ denotes the \zinf{} interval at the $i^{th}$
  dimension.

  The set of $N$ dimensional vector intervals is $\textit{Interval}^N$. Every
  vector interval is also an offsets vector.
\end{defn}

\unused{
  \begin{lem}{}
    Intersection distributes $N$ dimensional vector intervals:
  %
    \begin{gather*}
      (\interv{a_1}{b_1}{c_1}, \dots, \interv{a_N}{b_N}{c_N}) \; \cap \;
        (\interv{a'_1}{b'_1}{c'_1}, \dots, \interv{a'_N}{b'_N}{c'_N}) \\
      = \\
      (\interv{\max \{a_1,a'_1\}}{\min \{b_1,b'_1\}}{\neg c_1 \vee \neg c'_1},
        \dots, \interv{\max \{a_N,a'_N\}}{\min \{b_N,b'_N\}}{\neg c_N \vee \neg c'_N})
    \end{gather*}
  \end{lem}
  %
  \begin{proof}
    This immediately follows from \Cref{lem:vector-intersect} and
    \Cref{lem:zinf-identities}.
  \end{proof}
}

\begin{defn}{(\emph{Region space})}
  Region space defines the set \textit{Region} in $N$ dimensions inductively as
  follows:
%
  \begin{enumerate}
    \item If $R$ is in $\textit{Interval}^N$, then $R$ is in \textit{Region}.
    \item If $R$ and $S$ are in \textit{Region}, then so are $R \cap S$ and $R
      \cup S$.
  \end{enumerate}
\end{defn}

\begin{prop}{}
  $(\textit{Region},\supseteq)$ is a distributive lattice.
\end{prop}
%
\begin{proof}
  Any sublattice of a distributive lattice is a distributive lattice. Power sets
  coupled with partially ordered with superset or equals relation are
  distributive lattices. \textit{Region} is a subset of
  $\mathcal{P}{(\zinf{}^{\mkern-19mu{N}})}$ since all vector intervals are
  subsets of this power set and union and intersection cannot add an element
  that is not already in the powerset. Therefore, \textit{Region} is a
  distributive sublattice of $\mathcal{P}{(\zinf{}^{\mkern-19mu{N}})}$.
\end{proof}

\begin{defn}{}
  \textsf{Mult} and \textsf{Approx} are parametric labelled variant types with
  injections given by their definition:
%
  \begin{align*}
    \textsf{Mult} \; a &
      \triangleq \textsf{mult} \; a \;\mid\; \textsf{only} \; a \\
    \textsf{Approx} \; a &
      \triangleq \textsf{exact} \; a \;\mid\; \textsf{lower} \; a \;\mid\;
        \textsf{upper} \; a \;\mid\; \textsf{both} \; a \; a
  \end{align*}
%
  \eg{}, \textsf{lower} is an injection $\mathsf{lower} : a \to \mathsf{Approx}
  \; a$ etc.

  These will be used in the following subsection to give meaning to the
  specification modifiers for approximation and multiplicity.
\end{defn}

\subsection{Denotational semantics for specifications}

We give some basic interpretations: $\interp{\texttt{n}} = n$ where $n$ is in
$\mathbb{Z}$, $\interp{\texttt{pointed}} = \llbracket \epsilon \rrbracket =
\textsf{true}$, $\interp{\texttt{nonpointed}} = \textsf{false}$.
Typographically, cursive font is used within specifications to indicate a
partial textual capture. For convenience we use \textit{italic} serif font
inside specifications rather than interpreting its textual capture.  These
coalesces syntactic and semantic representation but avoids clutter in the
presentation.

Let $\textit{vec-gen}_N : \mathbb{N} \times \textit{Interval} \to
\textit{Interval}^N$ be the function generating an $N$ dimensional vector
interval such that \vecgen{N}{i}{\interv{a}{b}{c}} has
$\interv{-\infty}{\infty}{\textsf{p}}$ in all dimensions except the $i^{th}$
one. There, it has \interv{a}{b}{c}.

First, we give meaning to region constants (introduced in \Cref{}).
%
\begin{align*}
  \interp{\stencil{p}{$n$}{}{}}_N & =
    \vecgen{N}{\interp{i}}{\interv{0}{0}{\textsf{true}}}\\
%
  \interp{\stencil{c}{$i$}{$k$}{\textcap{p}}}_N & =
    \vecgen{N}{i}{\interv{-k}{k}{\interp{\textcap{p}}}} \\
%
  \interp{\stencil{f}{$i$}{$k$}{\textcap{p}}}_N & =
    \vecgen{N}{\textcap{i}}{\interv{0}{k}{\interp{\textcap{p}}}} \\
%
  \interp{\stencil{b}{$i$}{$k$}{\textcap{p}}}_N & =
  \vecgen{N}{\textcap{i}}{\interv{-k}{0}{\interp{\textcap{p}}}}
\end{align*}

Second, we provide the semantics for the permissive region operator, \texttt{+},
and the restrictive region operator, \texttt{*}, by associating them with meet
and join respectively. Let \texttt{\textit{R}} and \texttt{\textit{S}} be
regions.
%
\begin{align*}
  \interp{\texttt{\textcap{R} + \textcap{S}}}_N & =
    \interp{\textcap{R}}_N \wedge \interp{\textcap{S}}_N
&
  \interp{\texttt{\textcap{R} * \textcap{S}}}_N & =
    \interp{\textcap{R}}_N \vee \interp{\textcap{S}}_N
\end{align*}

Third, we need to mark presence of modifiers such as \texttt{readOnce} and
\texttt{atMost} as introduced in \Cref{}. In the context of
multiplicity modifiers we have the following semantics:
%
\begin{align*}
  \interp{\texttt{readOnce}} & = \textsf{mult} &
  \llbracket\epsilon\rrbracket & = \textsf{once}
\end{align*}

In the context of approximation modifiers, we have
%
\begin{align*}
  \interp{\texttt{atLeast}} & = \textsf{lower} &
  \interp{\texttt{atMost}} & = \textsf{upper} &
  \llbracket \epsilon \rrbracket = \textsf{exact}
\end{align*}

Finally, we can give full semantics of a stencil specification:
%
\begin{equation*}
  \interp{\texttt{stencil \textcap{Mult}, \textcap{Appr}, \textcap{Region}}} =
    \interp{\textcap{Mult}}
           {(\interp{\textcap{Appr}}
                    {(\interp{\textcap{Region}})})}
\end{equation*}

\section{Equational \& approximation theories}

We know introduce the equational and approximation theory of stencil
specifications based on $\equiv$ and $\preceq$.

\subsection{Equivalences}

We define an equivalence relation, $\equiv$, on regions as follows:

\begin{description}
  \item[Basic] \texttt{*} and \texttt{+} are both idempotent, commutative, and
    associative;
%
  \item[Dist] \texttt{*} distributed over \texttt{+} and dually
    \texttt{+} distributes over \texttt{*}, meaning if \textcap{R}, \textcap{S},
    and \textcap{T} are regions, then we have the following equivalences:
%
    \begin{align*}
      \texttt{\textcap{R}*(\textcap{S}+\textcap{T})} & \equiv
        \texttt{(\textcap{R}*\textcap{S})+(\textcap{R}*\textcap{T})} &
      \texttt{\textcap{R}+(\textcap{S}*\textcap{T})} & \equiv
        \texttt{(\textcap{R}+\textcap{S})*(\textcap{R}+\textcap{T})}
    \end{align*}
%
  \item[Overlapping pointed] If \textcap{R} is one of \texttt{forward},
    \texttt{backward}, or \texttt{centered}, then we have
    $\texttt{\textcap{R}(depth=$k$,dim=$n$,\_) + \stencil[s]{p}{$n$}{}{}} \equiv
    \texttt{\textcap{R}(depth=$k$,dim=$n$)}$.
%
  \item[Centered] The region constants \texttt{forward} and \texttt{backward}
    are two halves of \texttt{centered} specifications:
%
    \begin{equation*}
      \stencil[s]{c}{$n$}{$k$}{\textcap{p1}} \equiv
        \stencil[s]{f}{$n$}{$k$}{\textcap{p2}} \texttt{+}
        \stencil[s]{f}{$n$}{$k$}{\textcap{p3}}
    \end{equation*}
%
    Here \textcap{p1} is \texttt{nonpointed} if both \textcap{p2} and
    \textcap{p3} are \texttt{nonpointed} and \texttt{pointed} otherwise.
%
  \item[Point] Let \textcap{R} and \textcap{S} be region constants with two
    variants a superscript \textit{f} to mean nonpointed and \textit{t} to mean
    pointed and \textcap{dr} \& \textcap{ds} be the dimensions \textcap{R} and
    \textcap{S} acts on. Then we have the following dual equivalences:
%
    \begin{align*}
      (\textcap{R}^{\textit{t}} \texttt{*} \textcap{S}^{\textit{f}})
      \;\texttt{+}\;
      (\textcap{R}^{\textit{f}} \texttt{*} \textcap{S}^{\textit{t}})
      \;\texttt{+}\;
      \texttt{p(dim=\textcap{dr})*p(dim=\textcap{ds})} & =
        \textcap{R}^{\textit{t}} \texttt{*} \textcap{S}^{\textit{t}} \\
%
      (\textcap{R}^{\textit{t}} \texttt{+} \textcap{S}^{\textit{f}}) \texttt{*}
      (\textcap{R}^{\textit{f}} \texttt{+} \textcap{S}^{\textit{t}}) & =
        \textcap{R}^{\textit{f}} \texttt{+} \textcap{S}^{\textit{f}}
        \;\texttt{+}\;
        \texttt{p(dim=\textcap{dr})*p(dim=\textcap{ds})}
    \end{align*}
\end{description}

\begin{thm}{(Soundness)}
  Equational theory is sound with respect to the lattice model. Let $R$
  and $S$ be $N$ dimensional regions, then we have
%
  \begin{equation*}
    R \equiv S \implies \interp{R}_N \equiv \interp{S}_N
  \end{equation*}
\end{thm}

\begin{proof}
  Both $\equiv$ and $=$ are equivalence relations. We only need to show that
  each property associated with specifications equivalence holds as an equality
  in the model.
%
  \begin{description}
    \item[Basic] These follow from basic properties of lattices.
%
    \item[Dist] This is immediate from the definition of distributive
      lattice which the model is one.
%
    \item[Overlapping pointed] Let $\interp{\textcap{n}}$ be $n$. Counterparts
      of individual regions for some Boolean $p$ are given below:
%
      \begin{align*}
        \interp{\texttt{\textcap{R}(depth=\textcap{k},dim=\textcap{n},\_)}}_N
        & = \vecgen{N}{n}{\interv{-k}{k}{p}} \\
%
        \interp{\texttt{pointed(dim=\textcap{n})}}_N
        &= \vecgen{N}{n}{\interv{0}{0}{\textsf{true}}} \\
%
        \interp{\texttt{\textcap{R}(depth=\textcap{k},dim=\textcap{n})}}_N
        &= \vecgen{N}{n}{\interv{-k}{k}{\textsf{true}}}
      \end{align*}

      Using \Cref{lem:vector-union}, it is sufficient to show
      $ \interv{-k}{k}{p} \;\cup\; \interv{0}{0}{\textsf{true}} =
        \interv{-k}{k}{\textsf{true}} $ holds. This immediately follows from
      \Cref{lem:zinf-identities}.
%
    \item[Centered] Let $\interp{\textcap{n}}$, $\interp{\textcap{k}}$,
      $\interp{\textcap{p1}}$, $\interp{\textcap{p2}}$, and
      $\interp{\textcap{p3}}$ be $n$, $k$, $p1$, $p2$, and $p3$ respectively. We
      also know that $p1$ is $p2 \vee p3$ from \textbf{Centered} detinition.
      Then we get the following interpretation for region constants involved in
      the equivalence:
%
      \begin{align*}
        \interp{\texttt{centered(depth=\textcap{k},dim=\textit{n},\textcap{p1})}}_N
          &= \vecgen{N}{n}{\interv{-k}{k}{p2 \vee p3}} \\
%
        \interp{\texttt{forward(depth=\textcap{k},dim=\textit{n},\textcap{p2})}}_N
          &= \vecgen{N}{n}{\interv{0}{k}{p2} }\\
%
        \interp{\texttt{backward(depth=\textcap{k},dim=\textit{n},\textcap{p3})}}_N
          &= \vecgen{N}{n}{\interv{0}{k}{p3}}
      \end{align*}
%
      Using \Cref{lem:vector-union}, it is sufficient to show $\interv{-k}{k}{p2
      \vee p3} = \interv{0}{k}{p2} \cup \interv{-k}{0}{p3}$ holds. This
      immediately follows from \Cref{lem:zinf-identities}.

    \item[Point] We will prove the first equivalence and then use that to prove
      the second.
%
      Let $\interp{\textcap{R}^{\textnormal{\textit{p}}}}_N$ and
      $\interp{\textcap{S}^{\textnormal{\textit{p'}}}}_N$ be
      $\vecgen{N}{k}{\interv{a}{b}{p}}$ and $\vecgen{N}{l}{\interv{c}{d}{p'}}$
      respectively for some $a$ and $c$ less than or equal to 0, for some $c$
      and $d$ greater than or equal to 0, for some indices $k$ and $l$ be
      $\interp{\textcap{dr}}$ and $\interp{\textcap{ds}}$, which are not
      necessarily distinct and $p$ and $p'$ are \textsf{true} if pointed and
      \textsf{false} otherwise.
%
      \begin{align*}
        \hspace{2em&\hspace{-2em}}
        \interp
          {{(\textcap{R}^{\textit{t}} * \textcap{S}^{\textit{f}})}
           \;\texttt{+}\;
           {(\textcap{R}^{\textit{f}} * \textcap{S}^{\textit{t}})}
           \;\texttt{+}\;
           \texttt{pointed(dim=\textcap{dr})*pointed(dim=\textcap{ds})}}_N \\
        & = {(\interp{\textcap{R}^{\textit{t}}}_N \cap
              \interp{\textcap{S}^{\textit{f}}}_N)} \cup
            {(\interp{\textcap{R}^{\textit{f}}}_N \cap
              \interp{\textcap{S}^{\textit{t}}}_N)} \;\cup \\
        & \quad\,\, {(\vecgen{N}{\interp{ds}}{\interv{0}{0}{\textsf{true}}}
                      \;\cup\;
                      \vecgen{N}{\interp{dr}}{\interv{0}{0}{\textsf{true}}})} \\
        & = \{ x \mid
            \bigwedge_{\substack{1 \leq i \leq N \\ i \neq k \neq l}} x_i \in
              \interv{\infty}{\infty}{\textsf{true}}
            \wedge a \leq x_k \leq b
            \wedge {(c \leq x_l \leq d \wedge x_l \neq 0)} \} \;\cup \\
        & \quad\,\, \{ x \mid
            \bigwedge_{\substack{1 \leq i \leq N \\ i \neq k \neq l}} x_i \in
              \interv{\infty}{\infty}{\textsf{true}}
            \wedge {(a \leq x_k \leq b \wedge x_k \neq 0)}
            \wedge c \leq x_l \leq d \} \;\cup \\
        & \quad\,\, \{ x \mid
            \bigwedge_{\substack{1 \leq i \leq N \\ i \neq k \neq l}} x_i \in
              \interv{\infty}{\infty}{\textsf{true}}
            \wedge (x_k = 0 \wedge x_l = 0) \} \\
        & = \{ x \mid
            \bigwedge_{\substack{1 \leq i \leq N \\ i \neq k \neq l}} x_i \in
              \interv{\infty}{\infty}{\textsf{true}}
            \wedge a \leq x_k \leq b
          \wedge c \leq x_l \leq d \wedge {(x_k \neq 0 \vee x_l \neq 0)} \}
          \;\cup \\
        & \quad\,\, \{ x \mid
            \bigwedge_{\substack{1 \leq i \leq N \\ i \neq k \neq l}} x_i \in
              \interv{\infty}{\infty}{\textsf{true}}
            \wedge (x_k = 0 \wedge x_l = 0) \} \\
        & = \{ x \mid
            \bigwedge_{\substack{1 \leq i \leq N \\ i \neq k \neq l}} x_i \in
              \interv{\infty}{\infty}{\textsf{true}}
            \wedge a \leq x_k \leq b
            \wedge c \leq x_l \leq d \} \\
        & = \interp{\textcap{R}^{\textit{t}} \texttt{*} \textcap{S}^{\textit{t}}}_N
      \end{align*}
%
      Now we prove the second equivalence:
      \begin{align*}
        \hspace{2em}&\hspace{-2em} \interp{
            (\textcap{R}^{\textit{t}} \texttt{+} \textcap{S}^{\textit{f}})
            \texttt{*}
            (\textcap{R}^{\textit{f}} \texttt{+} \textcap{S}^{\textit{t}})
          }_N \\
        &= \interp{
             (\textcap{R}^{\textit{t}} \texttt{*} \textcap{R}^{\textit{f}})
             \texttt{+}
             (\textcap{S}^{\textit{t}} \texttt{*} \textcap{S}^{\textit{f}})
             \texttt{+}
             (\textcap{R}^{\textit{t}} \texttt{*} \textcap{S}^{\textit{t}})
             \texttt{+}
             (\textcap{R}^{\textit{f}} \texttt{*} \textcap{S}^{\textit{f}})
           }_N \\
        &= \interp{
             \textcap{R}^{\textit{f}}
             \texttt{+}
             \textcap{S}^{\textit{f}}
             \texttt{+}
             (\textcap{R}^{\textit{t}} \texttt{*} \textcap{S}^{\textit{t}})
           }_N \\
        &= \interp
             {\textcap{R}^{\textit{f}}
              \texttt{+}
              \textcap{S}^{\textit{f}}
              \texttt{+}
              {(\textcap{R}^{\textit{t}} \texttt{*} \textcap{S}^{\textit{f}})}
               \;\texttt{+}\;
               {(\textcap{R}^{\textit{f}} \texttt{*} \textcap{S}^{\textit{t}})}
               \;\texttt{+}\;
               \texttt{pointed(dim=\textcap{dr})*pointed(dim=\textcap{ds})}}_N \\
        &= \interp{\textcap{R}^{\textit{f}} \texttt{+} \textcap{S}^{\textit{f}}
                   \;\texttt{+}\;
                   \texttt{pointed(dim=\textcap{dr})*pointed(dim=\textcap{ds})}}_N
      \end{align*}
  \end{description}
\end{proof}

\subsection{Approximations}
We define a partial of order of approximations, $\preceq$. This relation
provides us with the following:

\begin{description}
  \item[Centered]
  \item[Point] Let \textcap{R} be a region constant with two variants: a
    superscript $f$ to mean nonpointed and $t$ to mean pointed. Then we have
    $\textcap{R}^t \preceq \textcap{R}^f$.
\end{description}

\section{Analysis, Consistency, Inference}

\subsection{Analysis}

\subsection{Consisteny}

\subsection{Inference}

\begin{thm}{(Completeness of inference)}\label{thm:inf-completeness}
  Inference procedure can infer a specification for every stencil computation.
\end{thm}
%
\begin{proof}
  Would be nice to have.
\end{proof}

\begin{thm}{(Completeness of exact inference)}
  Inference procedure can infer a specification for every stencil computation
  with array indexing behaviour forms a superposition of hyperrectangles removed
  at most one unit from the origin in any of its dimension.
\end{thm}
%
\begin{proof}
  Would be nice to have.
\end{proof}

\begin{thm}{(Optimality of inference)}\label{thm:inf-optimality}
  For exact inference, inference procedure always infers specifications with
  fewest number of region constants.
\end{thm}
%
\begin{proof}
  Would be nice to have.
\end{proof}

\begin{remark}{}
  Optimality of general inference is trivial. We only need a single region
  constant covering accesses in any one of the stencil's dimensions and that
  would provide an upper bound for the stencil.
\end{remark}

\end{document}
